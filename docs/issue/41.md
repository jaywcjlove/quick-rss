SwiftUI çš„åè°ƒå™¨çˆ¶çº§çš„å¥½å¥‡æ¡ˆä¾‹
===

æˆ‘åœ¨ SwiftUI æ–¹é¢è¿˜æ˜¯ä¸ªåˆå­¦è€…ã€‚æˆ‘å¶å°”å°è¯•è¿‡ï¼Œä½†å¤§éƒ¨åˆ†æ—¶é—´æˆ‘çœŸçš„ä¸çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚æœ€è¿‘ï¼Œæˆ‘æœ‰æœºä¼šå†è¯•ä¸€æ¬¡ã€‚å¯¹äºè¿™ä¸ªç‰¹å®šçš„å®éªŒï¼Œæˆ‘æƒ³å°†ä¸€ä¸ªç°æœ‰çš„è§†å›¾å°è£…èµ·æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥ä» SwiftUI è®¿é—®å®ƒã€‚è¿™éƒ¨åˆ†æ˜¯ç›¸å½“æ ‡å‡†çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œæˆ‘æ•¢æ‰“èµŒæˆ‘ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªã€‚

### é—®é¢˜

å½“æˆ‘å­¦ä¹ ä¸€ä¸ªæ–°çš„ API æ—¶ï¼Œæˆ‘å–œæ¬¢ä»ä¸€ä¸ªæ–°çš„é¡¹ç›®å¼€å§‹ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä¸“æ³¨äºä»»åŠ¡ï¼Œé¿å…ä¸æ›´å¤§é¡¹ç›®é›†æˆæ—¶çš„å¤æ‚æ€§ã€‚æˆ‘çš„ç›®æ ‡æ˜¯å°† `NSTableView` åŒ…è£…èµ·æ¥ï¼Œå¹¶å°†å…¶åµŒå…¥åˆ° SwiftUI çš„è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ã€‚æ‰€ä»¥ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¹¶æ ¹æ®è‹¹æœçš„ SwiftUI æ•™ç¨‹ [Interfacing with UIKit](https://developer.apple.com/tutorials/swiftui/interfacing-with-uikit) è¿›è¡Œæ“ä½œï¼ŒæŒ‰ç…§éœ€è¦å°†å…¶é€‚é…ä¸º AppKit å’Œæˆ‘çš„é—®é¢˜ã€‚

æˆ‘æ„Ÿè§‰æŒºä¸é”™çš„ï¼Œå› ä¸ºæˆ‘å¾ˆå¿«å°±å®ç°äº†åŸºæœ¬åŠŸèƒ½ã€‚è¿™ä¸ªå®ç°éµå¾ªäº† `View`-`NSView`-`Coordinator` çš„æ¨¡å¼ï¼Œç»“æ„åœ¨ä»”ç»†ç ”ç©¶ä¹‹åå¾ˆå®¹æ˜“ç†è§£ã€‚

ä»¥ä¸‹æ˜¯æˆ‘ç¼–å†™çš„ä»£ç ï¼š

```swift
struct EventsTableView: NSViewRepresentable {
    var events: [String]

    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }

    func makeNSView(context: Context) -> NSScrollView {
        let column = NSTableColumn(identifier: .exampleColumn)
        column.width = 100.0

        let tableView = NSTableView()

        tableView.headerView = nil
        tableView.addTableColumn(column)
        tableView.delegate = context.coordinator
        tableView.dataSource = context.coordinator

        let view = NSScrollView()

        view.documentView = tableView

        return view
    }

    func updateNSView(_ nsView: NSScrollView, context: Context) {
        let tableView = nsView.documentView as! NSTableView

        tableView.reloadData()
    }
}

extension EventsTableView {
    final class Coordinator: NSObject, NSTableViewDataSource, NSTableViewDelegate {
        var parent: EventsTableView

        init(_ parent: EventsTableView) {
            self.parent = parent
        }

        func numberOfRows(in tableView: NSTableView) -> Int {
            return parent.events.count
        }

        func tableView(_ tableView: NSTableView, viewFor tableColumn: NSTableColumn?, row: Int) -> NSView? {
            let reusedView = tableView.makeView(withIdentifier: .exampleColumn, owner: self)
            let view = reusedView as? NSTextField ?? NSTextField(labelWithString: "")

            view.stringValue = parent.events[row]

            return view
        }
    }
}
```

æˆ‘ä¹‹å‰æåˆ°ä¸€åˆ‡éƒ½åœ¨æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯ï¼Œå½“æˆ‘è¿›ä¸€æ­¥å®éªŒæ—¶ï¼Œå¾ˆå¿«å‘ç°å³ä½¿æˆ‘åœ¨æ›´æ–°æ—¶é‡æ–°åŠ è½½è¡¨è§†å›¾ï¼Œå…¶å†…å®¹ä¹Ÿå§‹ç»ˆæ²¡æœ‰å˜åŒ–ã€‚

å½“ç„¶ï¼Œäº‹åçœ‹æ¥ï¼Œé—®é¢˜æ˜¾è€Œæ˜“è§ã€‚ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ã€‚å¦‚æœæ²¡æœ‰å‘ç°ï¼Œä¹Ÿåˆ«æ„Ÿåˆ°ç³Ÿç³•ï¼Œå› ä¸ºæˆ‘èŠ±äº†ä¸å°‘æ—¶é—´è°ƒè¯•å’Œæ€è€ƒï¼Œæ‰å®Œå…¨æ˜ç™½é—®é¢˜å‡ºåœ¨å“ªé‡Œã€‚

### çˆ¶çº§ï¼Ÿ

SwiftUI çš„äº’æ“ä½œæ€§å›´ç»•ç€ä¸€ä¸ªåŒ…è£…è§†å›¾ `EventsTableView` åŠå…¶åè°ƒå™¨ `Coordinator` å±•å¼€ã€‚è¿™ä¸ªåè°ƒå™¨å®ä¾‹ä¼šåœ¨è§†å›¾éœ€è¦æ›´æ”¹æ—¶ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’å›å»ã€‚åŒ…è£…è§†å›¾å’Œåè°ƒå™¨ä¹‹é—´çš„è¿™ç§å…³ç³»è‡³å…³é‡è¦ï¼Œç†è§£å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»ä¹ŸåŒæ ·é‡è¦ã€‚

SwiftUI çš„è§†å›¾åœ¨æ­£å¸¸æ‰§è¡ŒæœŸé—´ä¼šéå¸¸é¢‘ç¹åœ°è¢«é‡æ–°åˆ›å»ºï¼Œè¿™å¾ˆæ­£å¸¸ã€‚ä½†ä½ çš„åè°ƒå™¨å®ä¾‹åªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œå¹¶å°½å¯èƒ½åœ°è¢«é‡ç”¨ã€‚è¿™å…¶å®æ˜¯éå¸¸æ ‡å‡†çš„å€¼ç±»å‹/å¼•ç”¨ç±»å‹çš„è¡Œä¸ºã€‚å½“åè°ƒå™¨å°†åŒ…è£…è§†å›¾ä½œä¸ºåˆå§‹åŒ–å‚æ•°æ—¶ï¼Œå®ƒä¼šæ‹·è´é‚£ä¸ªè§†å›¾çš„ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„ç‰ˆæœ¬ã€‚è€Œå½“ SwiftUI åŒ…è£…è§†å›¾è¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œè¿™ä¸ªæ‹·è´å¹¶ä¸ä¼šæ›´æ–°ã€‚

æˆ‘çš„é—®é¢˜åœ¨äºï¼Œ`Coordinator` åˆ›å»ºæ—¶ï¼Œçˆ¶çº§å±æ€§åŠå…¶ç›¸å…³äº‹ä»¶åªè¢«å¤åˆ¶äº†ä¸€æ¬¡ï¼Œç„¶åå°±å†ä¹Ÿæ²¡æœ‰æ›´æ–°è¿‡ã€‚å½“æˆ‘æ„è¯†åˆ°è¿™ä¸€ç‚¹æ—¶ï¼Œæˆ‘è§‰å¾—è‡ªå·±æœ‰ç‚¹è ¢ã€‚è§†å›¾æ˜¯å€¼ç±»å‹ï¼Œå½“ç„¶å®ƒä¸ä¼šæ›´æ–°ï¼ä½†æˆ‘ä¹Ÿä¸æƒ³å¯¹è‡ªå·±å¤ªè‹›åˆ»ï¼Œå› ä¸ºè¿™ç§åè°ƒå™¨æ•è·çˆ¶çº§è§†å›¾çš„æ¨¡å¼éå¸¸æ™®éã€‚è®¸å¤šå…³äºè¿™ä¸€ä¸»é¢˜çš„åšå®¢æ–‡ç« ä¸­éƒ½å­˜åœ¨è¿™ç§æ¨¡å¼ã€‚åŒ…æ‹¬è‹¹æœçš„ï¼ˆè¡¨é¢ä¸Šæ˜¯æƒå¨çš„ï¼‰[æ•™ç¨‹](https://developer.apple.com/tutorials/swiftui/interfacing-with-uikit)ï¼Œéƒ½ä½¿ç”¨äº†è¿™ç§çˆ¶çº§æ¨¡å¼ã€‚æˆ‘çŒœè¿™å°±æ˜¯é—®é¢˜çš„æ ¹æºã€‚

### æ•è·å±æ€§

åœ¨æˆ‘çš„æ¡ˆä¾‹ä¸­ï¼Œè§£å†³æ–¹æ¡ˆå…¶å®å¾ˆç®€å•ã€‚å…³é”®æ˜¯è¦åœ¨åè°ƒå™¨å®ä¾‹ä¸­æ•è·å¹¶æ›´æ–°æ•°æ®ã€‚

```swift
struct EventsTableView: NSViewRepresentable {
    var events: [String]

    func makeCoordinator() -> Coordinator {
        Coordinator(events: events) // <- è¿™é‡Œï¼
    }

    // çœç•¥éƒ¨åˆ†ä»£ç ...

    func updateNSView(_ nsView: NSScrollView, context: Context) {
        context.coordinator.events = events // <- è¿™é‡Œä¹Ÿæ˜¯ï¼

        let tableView = nsView.documentView as! NSTableView
        tableView.reloadData()
    }
}
```

å½“æˆ‘å®Œå…¨æ„è¯†åˆ°åè°ƒå™¨å®ä¾‹æ˜¯é•¿æœŸå­˜åœ¨çš„æ—¶ï¼Œæ•è·çˆ¶è§†å›¾å°±æ¯«æ— æ„ä¹‰äº†ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®è®©æˆ‘è¯¯ä»¥ä¸ºæˆ‘æœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å…³ç³»ï¼Œè€Œè¿™ç§å…³ç³»æ˜¯å¯è¡Œçš„ã€‚å¦‚æœè¿™ä¸ªå±æ€§è¢«ç§°ä¸º `firstParent` æˆ–è€… `creatingView`ï¼Œä¹Ÿè®¸æˆ‘å°±ä¸ä¼šçŠ¯è¿™ä¸ªé”™è¯¯äº†ã€‚

### æ°¸è¿œä¸è¦æ•è·çˆ¶è§†å›¾

ç»å†äº†è¿™ä¸€åˆ‡åï¼Œæˆ‘ä¸ç¡®å®šæ˜¯å¦èƒ½æƒ³åˆ°ä»»ä½•ä¸€ä¸ªä½ éœ€è¦æ•è· `Coordinator` åˆ›å»ºè§†å›¾å‰¯æœ¬çš„ç†ç”±ã€‚å¦‚æœä½ çŸ¥é“è¿™ç§çˆ¶è§†å›¾-åè°ƒå™¨æ¨¡å¼å¯èƒ½æœ‰ç”¨çš„åŸå› ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚ä¸è¿‡å³ä¾¿æœ‰ä¸€äº›åˆé€‚çš„åœºæ™¯ï¼Œæˆ‘ä»ç„¶è®¤ä¸ºè¿™ç§æ¨¡å¼å¤ªå®¹æ˜“è®©äººå›°æƒ‘ï¼Œå°±åƒæˆ‘ä¸€æ ·ï¼Œå› æ­¤æœ€å¥½è¿˜æ˜¯é¿å…ä½¿ç”¨ã€‚

ğŸ‘‰ https://www.massicotte.org/swiftui-coordinator-parent

---

<p align="center">
<a href="https://www.massicotte.org/swiftui-coordinator-parent" target="_blank">ğŸ”— æŸ¥çœ‹é“¾æ¥</a> â€¢ 
<a href="https://github.com/jaywcjlove/quick-rss/issues/new/choose" target="_blank">æŠ•ç¨¿/æ¨è/è‡ªè</a> â€¢ 
<a href="https://wangchujiang.com/quick-rss/feeds/index.html" target="_blank">Quick RSS</a> â€¢ 
<a href="https://github.com/jaywcjlove/quick-rss/issues/41" target="_blank">#41</a> â€¢ 
<a href="https://github.com/jaywcjlove" target="_blank">@jaywcjlove</a>
</p>

---
    